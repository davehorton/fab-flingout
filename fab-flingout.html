<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../iron-dropdown/iron-dropdown.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../neon-animation/animations/slide-from-bottom-animation.html">
<link rel="import" href="../neon-animation/animations/slide-from-top-animation.html">
<link rel="import" href="../neon-animation/animations/slide-down-animation.html">
<link rel="import" href="../neon-animation/animations/slide-up-animation.html">
<link rel="import" href="../neon-animation/animations/fade-out-animation.html">
<link rel="import" href="fab-flingout-animations.html">

<!--
`fab-flingout`
A floating action button that flings out subidiary buttons

@demo demo/index.html
-->

<dom-module id="fab-flingout">
  <template>
    <style>
      :host {
        display: block;
      }

      #dropdown .dropdown-content ::content > paper-fab  {
        margin: 20px 0px ;
      }
      #dropdown .dropdown-content ::content > paper-fab[mini]  {
        margin: 20px 0px 20px 8px ;
      }

    </style>

    <div on-tap="toggle">
      <paper-fab id="trigger" icon="[[_icon]]" class$="{{getTriggerClasses(opened)}}"></paper-fab>
    </div>

    <iron-dropdown
      id="dropdown"
      opened="{{opened}}"
      horizontal-align="left"
      vertical-align="[[verticalAlign]]"
      dynamic-align="[[dynamicAlign]]"
      horizontal-offset="[[horizontalOffset]]"
      vertical-offset="[[verticalOffset]]"
      no-overlap="true"
      open-animation-config="[[openAnimationConfig]]"
      close-animation-config="[[closeAnimationConfig]]"
      no-animations="[[noAnimations]]"
      focus-target="[[_dropdownContent]]"
      allow-outside-scroll="[[allowOutsideScroll]]"
      restore-focus-on-close="[[restoreFocusOnClose]]"
      on-iron-overlay-canceled="__onIronOverlayCanceled">
      <div class="dropdown-content">
        <content id="content"></content>
      </div>
    </iron-dropdown>

  </template>

  <script>
    Polymer({

      is: 'fab-flingout',
      behaviors: [Polymer.NeonAnimationRunnerBehavior],
      properties: {

        /*
         * icon to display when the list is not displayed
         */
        openIcon: {
          type: String,
          value: 'add'
        },

        /*
         * icon to display when the list is displayed
         */
        closeIcon: {
          type: String,
          value: 'close'
        },

        _icon: {
          type: String,
          computed: '_computeIcon(opened)'
        },

        /**
         * True if the content is currently displayed.
         */
        opened: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * The orientation against which to align the menu dropdown
         * vertically relative to the dropdown trigger.
         */
        verticalAlign: {
          type: String,
          value: 'top',
          reflectToAttribute: true
        },

        /**
         * An animation config. If provided, this will be used to animate the
         * opening of the dropdown.
         */
        openAnimationConfig: {
          type: Object,
          computed: '_computeOpenAnimationConfig(verticalAlign)'
        },

        /**
         * An animation config. If provided, this will be used to animate the
         * closing of the dropdown.
         */
        closeAnimationConfig: {
          type: Object,
          computed: '_computeCloseAnimationConfig(verticalAlign)'
        },

        animationConfig: {
          value: function() {
            return {
              'rotateToClose': {
                name: 'fab-flingout-spin-right-45',
                node: this.$.trigger,
                timing: {
                  delay: 0,
                  duration: 200
                }
              },
              'rotateToOpen': {
                name: 'fab-flingout-spin-left-45',
                node: this.$.trigger,
                timing: {
                  delay: 0,
                  duration: 200
                }
              }
            } ;
          }
        }

      },

      /**
       * Toggles the drowpdown content between opened and closed.
       */
      toggle: function() {
        this.opened = !this.opened ;
        this.playAnimation(this.opened ? 'rotateToClose' : 'rotateToOpen');
      },

      _computeIcon: function( opened ) {
        return opened ? this.closeIcon : this.openIcon ;
      },

      _computeOpenAnimationConfig: function(verticalAlign) {
        if( 'bottom' === this.verticalAlign ) {
          return [ {
            name: 'slide-from-bottom-animation',
            timing: {
              delay: 0,
              duration: 500
            }
          }, {
            name: 'fade-in-animation',
            timing: {
              delay: 100,
              duration: 400
            }
          }];
        }
        else {
          return [ {
            name: 'slide-from-top-animation',
            timing: {
              delay: 0,
              duration: 500
            }
          }, {
            name: 'fade-in-animation',
            timing: {
              delay: 100,
              duration: 400
            }
          }];
        }
      },

      _computeCloseAnimationConfig: function(verticalAlign) {
        console.log('verticalAlign: %s', this.verticalAlign) ;
        if( 'bottom' === this.verticalAlign ) {
          return [{
            name: 'fade-out-animation',
            timing: {
              delay: 0,
              duration: 500
            }
          }, {
            name: 'slide-down-animation',
            timing: {
              delay: 100,
              duration: 400
            }
          }];
        }
        else {
          return [{
            name: 'fade-out-animation',
            timing: {
              delay: 0,
              duration: 500
            }
          }, {
            name: 'slide-up-animation',
            timing: {
              delay: 100,
              duration: 400
            }
          }];
        }
      },

      getTriggerClasses: function(opened) {
        return opened ? 'open' : '' ;
      }
    });
  </script>
</dom-module>
